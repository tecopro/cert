/**
 * E-CERTIFICATE
 * @author Sofa Machabba Haeta
 * @copyright Technology Community
 * @description get file from certificate-generator repository and update index.html view
 */

const r=document.getElementById.bind(document),l=document.createElement.bind(document),u=document.createTextNode.bind(document),s=new bootstrap.Modal("#content-result",{keyboard:!1,i:"static"}),e=new bootstrap.Modal("#content-duplicate"),n=new bootstrap.Modal("#content-error",{keyboard:!1,i:"static"}),c=r("username"),d=r("period"),t=r("search"),m=(e,t)=>{for(var a in t)e.setAttribute(a,t[a])},f=(e,t)=>{void 0!==typeof t&&(r("error-heading").textContent=t),r("error-message").textContent=e,n.show()},p=t=>{const a=r("content-tbody-duplicate");a.textContent="",t.forEach((e=>{const t=l("tr"),n=l("th"),o=l("td"),i=l("button"),r=u(`${e.name} [${e.position}]`),s=u("Pilih");m(i,{type:"button",class:"btn btn-outline-primary","data-bs-dismiss":"modal",onclick:`r("username").value = "${e.name} @ ${e.code}"`}),i.appendChild(s),n.appendChild(r),o.appendChild(i),t.insertBefore(n,null),t.insertBefore(o,null),a.insertBefore(t,null)})),e.show()},i=async e=>{e.preventDefault();try{if(""===c.value.trim())f('Silahkan isi kolom "Nama Peserta" terlebih dahulu.',"Mohon maaf dengan siapa?");else if("default"===d.value)f('Silahkan isi kolom "Periode" terlebih dahulu.',"Sejak kapan mengikuti TECO?");else{var t=c.value.split(" @ "),a=JSON.parse(sessionStorage[`${d.value}`]).filter((function(e){var a=(e?.name||"").toLowerCase(),n=(t[0]||"").toLowerCase();return a.includes(n)}));if(void 0===a||0===a.length)f("Sepertinya ada masalah terkait nama anda, silahkan hubungi admin melalui E-Mail <tecopro.nepal@gmail.com> untuk informasi lebih lanjut.",`Halo, ${c.value.replace(/(^\w|\s\w)(\S*)/g,((e,t,a)=>t.toUpperCase()+a.toLowerCase()))}!`);else if(a.length>1&&void 0===t[1])p(a);else if("string"==typeof t[1]?void 0===(a=a.find((({code:e})=>e===t[1])))&&(a=!1,f("Kepemilikan kode unik yang anda masukkan tidak sesuai dengan hasil pencarian, anda dapat mencoba untuk mengganti periode atau silahkan hubungi admin melalui E-Mail <tecopro.nepal@gmail.com> untuk informasi lebih lanjut.",`Halo, ${t[0]} [${t[1]}]!`)):a=a.shift(),a){var n=[a.name,a.position,a.predicate,a.period,{href:`https://raw.githubusercontent.com/tecopro/certificate-generator/${d.value}/certificate/${a.file}`}];["result-name","result-position","result-predicate","result-period","download"].forEach(((e,t)=>{if("download"===e){var a=Object.keys(n[t]).shift();r(e).setAttribute(a,n[t][a])}else r(e).textContent=n[t]})),s.show()}}}catch(e){new Error(e),f(e)}};document.onreadystatechange=function(){var e=d.options,a=[];for(var n of e)"default"!==n.value&&a.push(n.value);a.forEach((async e=>{var t=await axios.get(`https://raw.githubusercontent.com/tecopro/certificate-generator/${e}/data.json`).catch((function(e){new Error(e),f("Terjadi kesalahan, silahkan coba beberapa saat lagi")}));sessionStorage.setItem(`${e}`,JSON.stringify(t.data))})),t.addEventListener("click",i),document.addEventListener("keypress",(function(e){"Enter"===e.key&&(e.preventDefault(),t.click())}))};